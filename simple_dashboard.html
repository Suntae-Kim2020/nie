<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ë¥˜ ì¶©ëŒ ëŒ€ì‹œë³´ë“œ (ê°„ì†Œí™”)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            font-family: 'Malgun Gothic', Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
            border-radius: 10px; 
            margin-bottom: 30px; 
        }
        .filters { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
        }
        .card { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .stat { 
            font-size: 2rem; 
            font-weight: bold; 
            color: #667eea; 
            margin-bottom: 10px; 
        }
        .chart-container { 
            position: relative; 
            height: 300px; 
        }
        select, button { 
            padding: 8px 12px; 
            margin: 5px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
        }
        button { 
            background: #667eea; 
            color: white; 
            cursor: pointer; 
        }
        button:hover { 
            background: #5a6fd8; 
        }
        .loading { 
            text-align: center; 
            padding: 20px; 
            color: #666; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0; 
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¦ ì¡°ë¥˜ ìœ ë¦¬ì°½ ì¶©ëŒì‚¬ê³  ëŒ€ì‹œë³´ë“œ</h1>
        <p>2023-2024ë…„ ì „êµ­ ë°ì´í„° ì‹¤ì‹œê°„ ë¶„ì„</p>
    </div>

    <div id="status" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>

    <div class="filters" id="filterSection" style="display: none;">
        <h3>ğŸ“Š ë°ì´í„° í•„í„°ë§</h3>
        <select id="yearFilter">
            <option value="all">ì „ì²´ ì—°ë„</option>
        </select>
        <select id="regionFilter">
            <option value="all">ì „ì²´ ì§€ì—­</option>
        </select>
        <select id="facilityFilter">
            <option value="all">ì „ì²´ ì‹œì„¤</option>
        </select>
        <button onclick="applyFilters()">í•„í„° ì ìš©</button>
        <button onclick="resetFilters()">ì´ˆê¸°í™”</button>
        <button onclick="exportData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
    </div>

    <div class="grid" id="statsGrid" style="display: none;">
        <div class="card">
            <h3>ğŸ“Š ì´ ì‚¬ê³  ê±´ìˆ˜</h3>
            <div class="stat" id="totalAccidents">0</div>
            <small>ì „ì²´ ê¸°ê°„</small>
        </div>
        <div class="card">
            <h3>ğŸ™ï¸ ì˜í–¥ë°›ì€ ì§€ì—­</h3>
            <div class="stat" id="totalRegions">0</div>
            <small>ì‹œë„</small>
        </div>
        <div class="card">
            <h3>ğŸ¦ ì¡°ë¥˜ ì¢… ìˆ˜</h3>
            <div class="stat" id="totalSpecies">0</div>
            <small>ì¢…</small>
        </div>
        <div class="card">
            <h3>ğŸ¢ ì£¼ìš” ì‹œì„¤</h3>
            <div class="stat" id="mainFacility">ë°©ìŒë²½</div>
            <small id="facilityPercent">0%</small>
        </div>
    </div>

    <div class="grid" id="chartsGrid" style="display: none;">
        <div class="card">
            <h3>ğŸ“… ì›”ë³„ ì‚¬ê³  ì¶”ì´</h3>
            <div class="chart-container">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h3>ğŸ—ºï¸ ì§€ì—­ë³„ ë¶„í¬</h3>
            <div class="chart-container">
                <canvas id="regionChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h3>ğŸ¦… ì¡°ë¥˜ ì¢…ë³„ ë¶„í¬</h3>
            <div class="chart-container">
                <canvas id="speciesChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h3>ğŸ—ï¸ ì‹œì„¤ë¬¼ë³„ ë¶„í¬</h3>
            <div class="chart-container">
                <canvas id="facilityChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let data = [];
        let filteredData = [];
        let charts = {};

        // ì´ˆê¸°í™”
        async function init() {
            console.log('ì´ˆê¸°í™” ì‹œì‘...');
            
            try {
                await loadData();
                showInterface();
                createCharts();
                updateStats();
                updateMessage('âœ… ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì™„ë£Œ', 'success');
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                updateMessage('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        async function loadData() {
            try {
                console.log('ì‹¤ì œ ë°ì´í„° ë¡œë”© ì‹œë„...');
                const response = await fetch('./bird_analysis_results.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const results = await response.json();
                data = results.raw_data || [];
                
                if (data.length === 0) {
                    throw new Error('ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ');
                }
                
                console.log('âœ… ì‹¤ì œ ë°ì´í„° ë¡œë“œ ì„±ê³µ:', data.length, 'ê°œ');
                
            } catch (error) {
                console.log('ì‹¤ì œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨, ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ìƒì„±:', error.message);
                generateSimulationData();
            }
            
            filteredData = [...data];
            populateFilters();
        }

        function generateSimulationData() {
            const regions = ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ê²½ê¸°ë„', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ', 'ëŒ€ì „ê´‘ì—­ì‹œ', 'ìš¸ì‚°ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ'];
            const species = ['ë©§ë¹„ë‘˜ê¸°', 'ì§ë°•êµ¬ë¦¬', 'ì°¸ìƒˆ', 'ë¬¼ê¹Œì¹˜', 'ë°•ìƒˆ', 'ë˜ì§€ë¹ ê·€', 'ì§‘ë¹„ë‘˜ê¸°', 'ë¶‰ì€ë¨¸ë¦¬ì˜¤ëª©ëˆˆì´'];
            const facilities = ['ë°©ìŒë²½', 'ê±´ë¬¼', 'ê¸°íƒ€'];
            
            data = [];
            for (let i = 0; i < 500; i++) {
                // 2024ë…„ì— ë” ë§ì€ ê°€ì¤‘ì¹˜ ë¶€ì—¬ (60% 2024ë…„, 40% 2023ë…„)
                const year = Math.random() < 0.6 ? 2024 : 2023;
                const month = Math.floor(Math.random() * 12);
                const day = Math.floor(Math.random() * 28) + 1;
                const date = new Date(year, month, day);
                
                data.push({
                    ê´€ì°°ì¼ì: date.toISOString().split('T')[0],
                    ì‹œë„ëª…: regions[Math.floor(Math.random() * regions.length)],
                    í•œê¸€ë³´í†µëª…: species[Math.floor(Math.random() * species.length)],
                    ì‹œì„¤ë¬¼ìœ í˜•ëª…: facilities[Math.floor(Math.random() * facilities.length)],
                    ê°œì²´ìˆ˜: Math.floor(Math.random() * 5) + 1
                });
            }
            
            console.log('ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ìƒì„±:', data.length, 'ê°œ');
        }

        function populateFilters() {
            // ì—°ë„ í•„í„°
            const years = [...new Set(data.map(item => new Date(item.ê´€ì°°ì¼ì).getFullYear()))].sort();
            const yearFilter = document.getElementById('yearFilter');
            yearFilter.innerHTML = '<option value="all">ì „ì²´ ì—°ë„</option>';
            years.forEach(year => {
                yearFilter.innerHTML += `<option value="${year}">${year}ë…„</option>`;
            });

            // ì§€ì—­ í•„í„°
            const regions = [...new Set(data.map(item => item.ì‹œë„ëª…))].sort();
            const regionFilter = document.getElementById('regionFilter');
            regionFilter.innerHTML = '<option value="all">ì „ì²´ ì§€ì—­</option>';
            regions.forEach(region => {
                regionFilter.innerHTML += `<option value="${region}">${region}</option>`;
            });

            // ì‹œì„¤ë¬¼ í•„í„°
            const facilities = [...new Set(data.map(item => item.ì‹œì„¤ë¬¼ìœ í˜•ëª…))].sort();
            const facilityFilter = document.getElementById('facilityFilter');
            facilityFilter.innerHTML = '<option value="all">ì „ì²´ ì‹œì„¤</option>';
            facilities.forEach(facility => {
                facilityFilter.innerHTML += `<option value="${facility}">${facility}</option>`;
            });
        }

        function applyFilters() {
            const year = document.getElementById('yearFilter').value;
            const region = document.getElementById('regionFilter').value;
            const facility = document.getElementById('facilityFilter').value;

            filteredData = data.filter(item => {
                const itemYear = new Date(item.ê´€ì°°ì¼ì).getFullYear().toString();
                
                if (year !== 'all' && itemYear !== year) return false;
                if (region !== 'all' && item.ì‹œë„ëª… !== region) return false;
                if (facility !== 'all' && item.ì‹œì„¤ë¬¼ìœ í˜•ëª… !== facility) return false;
                
                return true;
            });

            updateStats();
            updateCharts();
            
            updateMessage(`âœ… í•„í„° ì ìš© ì™„ë£Œ: ${filteredData.length}ê±´`, 'success');
        }

        function resetFilters() {
            document.getElementById('yearFilter').value = 'all';
            document.getElementById('regionFilter').value = 'all';
            document.getElementById('facilityFilter').value = 'all';
            
            filteredData = [...data];
            updateStats();
            updateCharts();
            
            updateMessage('ğŸ”„ í•„í„° ì´ˆê¸°í™” ì™„ë£Œ', 'success');
        }

        function updateStats() {
            document.getElementById('totalAccidents').textContent = filteredData.length.toLocaleString();
            document.getElementById('totalRegions').textContent = new Set(filteredData.map(item => item.ì‹œë„ëª…)).size;
            document.getElementById('totalSpecies').textContent = new Set(filteredData.map(item => item.í•œê¸€ë³´í†µëª…)).size;
            
            // ì‹œì„¤ë¬¼ë³„ í†µê³„
            const facilityCounts = {};
            filteredData.forEach(item => {
                facilityCounts[item.ì‹œì„¤ë¬¼ìœ í˜•ëª…] = (facilityCounts[item.ì‹œì„¤ë¬¼ìœ í˜•ëª…] || 0) + 1;
            });
            
            const topFacility = Object.entries(facilityCounts).sort((a, b) => b[1] - a[1])[0];
            if (topFacility) {
                const percentage = ((topFacility[1] / filteredData.length) * 100).toFixed(1);
                document.getElementById('mainFacility').textContent = topFacility[0];
                document.getElementById('facilityPercent').textContent = percentage + '%';
            }
        }

        function createCharts() {
            createMonthlyChart();
            createRegionChart();
            createSpeciesChart();
            createFacilityChart();
        }

        function updateCharts() {
            Object.values(charts).forEach(chart => {
                chart.destroy();
            });
            createCharts();
        }

        function createMonthlyChart() {
            const monthCounts = new Array(12).fill(0);
            filteredData.forEach(item => {
                const month = new Date(item.ê´€ì°°ì¼ì).getMonth();
                monthCounts[month]++;
            });

            const ctx = document.getElementById('monthlyChart').getContext('2d');
            charts.monthly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'],
                    datasets: [{
                        label: 'ì‚¬ê³  ê±´ìˆ˜',
                        data: monthCounts,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function createRegionChart() {
            const regionCounts = {};
            filteredData.forEach(item => {
                regionCounts[item.ì‹œë„ëª…] = (regionCounts[item.ì‹œë„ëª…] || 0) + 1;
            });

            const sortedRegions = Object.entries(regionCounts).sort((a, b) => b[1] - a[1]).slice(0, 8);

            const ctx = document.getElementById('regionChart').getContext('2d');
            charts.region = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedRegions.map(item => item[0]),
                    datasets: [{
                        label: 'ì‚¬ê³  ê±´ìˆ˜',
                        data: sortedRegions.map(item => item[1]),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function createSpeciesChart() {
            const speciesCounts = {};
            filteredData.forEach(item => {
                speciesCounts[item.í•œê¸€ë³´í†µëª…] = (speciesCounts[item.í•œê¸€ë³´í†µëª…] || 0) + 1;
            });

            const sortedSpecies = Object.entries(speciesCounts).sort((a, b) => b[1] - a[1]).slice(0, 6);

            const ctx = document.getElementById('speciesChart').getContext('2d');
            charts.species = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedSpecies.map(item => item[0]),
                    datasets: [{
                        data: sortedSpecies.map(item => item[1]),
                        backgroundColor: ['#667eea', '#764ba2', '#4facfe', '#00f2fe', '#43e97b', '#38f9d7']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function createFacilityChart() {
            const facilityCounts = {};
            filteredData.forEach(item => {
                facilityCounts[item.ì‹œì„¤ë¬¼ìœ í˜•ëª…] = (facilityCounts[item.ì‹œì„¤ë¬¼ìœ í˜•ëª…] || 0) + 1;
            });

            const ctx = document.getElementById('facilityChart').getContext('2d');
            charts.facility = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(facilityCounts),
                    datasets: [{
                        data: Object.values(facilityCounts),
                        backgroundColor: ['#ff6b6b', '#4ecdc4', '#45b7d1']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function exportData() {
            let csvContent = "ê´€ì°°ì¼ì,ì‹œë„ëª…,ì¡°ë¥˜ì¢…,ì‹œì„¤ë¬¼ìœ í˜•,ê°œì²´ìˆ˜\n";
            filteredData.forEach(item => {
                csvContent += `${item.ê´€ì°°ì¼ì},${item.ì‹œë„ëª…},${item.í•œê¸€ë³´í†µëª…},${item.ì‹œì„¤ë¬¼ìœ í˜•ëª…},${item.ê°œì²´ìˆ˜}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ì¡°ë¥˜ì¶©ëŒë°ì´í„°_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            updateMessage('ğŸ“ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ', 'success');
        }

        function showInterface() {
            document.getElementById('filterSection').style.display = 'block';
            document.getElementById('statsGrid').style.display = 'grid';
            document.getElementById('chartsGrid').style.display = 'grid';
        }

        function updateMessage(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = type;
            statusDiv.textContent = message;
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>